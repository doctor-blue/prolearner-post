# IoT for baby (TÃªn nÃ y láº¥y cho kÃªu) pháº§n 1

CÃ¡i tÃªn thÃ¬ cho Baby nhÆ°ng Baby nÃ y cÅ©ng pháº£i to ra pháº¿t má»›i tiÃªu hoÃ¡ Ä‘Æ°á»£c Ä‘á»‘ng chá»¯ nÃ y. Trong series nÃ y mÃ¬nh sáº½ share nhá»¯ng kiáº¿n thá»©c mÃ¬nh lá»¥m nháº·t Ä‘Æ°á»£c trong quÃ¡ trÃ¬nh lÃ m viá»‡c vá»›i cÃ¡c thiáº¿t bá»‹ IoT. CÅ©ng nhÆ° giÃºp cÃ¡c báº¡n hiá»ƒu hÆ¡n IoT lÃ  gÃ¬, á»©ng dá»¥ng cá»§a nÃ³, dÃ¹ng nhá»¯ng cÃ´ng nghá»‡ nÃ o. CÅ©ng cÃ³ thá»ƒ khÃ´ng chá»‰ cÃ³ lÃ½ thuyáº¿t xuÃ´ng mÃ  mÃ¬nh sáº½ cá»‘ gáº¯ng tÃ¬m cÃ¡ch lÃ m má»™t vÃ i vÃ­ dá»¥ náº¿u cÃ³ thá»ƒ, nhÆ°ng cÃ³ váº» sáº½ khÃ³ vÃ¬ IoT cáº§n kiáº¿n thá»©c pháº§n cá»©ng mÃ  mÃ¬nh láº¡i chá»‰ lÃ  má»™t thanh niÃªn dev pháº§n má»m Ä‘áº¿n dÃ¢y LÃ“NG (L) vÃ  dÃ¢y Náº NH (N) cÃ²n khÃ´ng phÃ¢n biá»‡t Ä‘Æ°á»£c ğŸ¤¨. Hi vá»ng nhá»¯ng bÃ i viáº¿t cá»§a mÃ¬nh sáº½ há»¯u Ã­ch vÃ  sáº½ khÃ´ng quÃ¡ ngÃ¡n vÃ¬ quÃ¡ nhiá»u chá»¯ vÃ  khÃ¡i niá»‡m, bá»Ÿi khi Ä‘á»c sáº½ kiá»ƒu tháº¥y chá»¯ bay pháº¥p phá»›i nháº£y mÃºa tung tÄƒng áº¥y ğŸ™„ğŸ™„ğŸ¥¹.

Äá» phÃ²ng kiá»ƒu gÃ¬ cÅ©ng cÃ³ bÃ¡c há»i táº¡i sao khÃ´ng táº¡o cÃ¡i blog mÃ  Ä‘Äƒng sao láº¡i dÃ¹ng file md tháº¿ nÃ y thÃ¬ [Ä‘Ã¢y](../../README.md) lÃ  lÃ½ do nhÃ© â¤ï¸â€ğŸ”¥â¤ï¸â€ğŸ”¥â¤ï¸â€ğŸ”¥.

Äá»ƒ má»Ÿ bÃ¡t cho loáº¡t bÃ i ``IoT for baby`` mÃ¬nh sáº½ giá»›i thiá»‡u Ä‘áº¿n cÃ¡c báº¡n chuáº©n káº¿t ná»‘i Ä‘Æ°á»£c dÃ¹ng nhiá»u nháº¥t gáº§n Ä‘Ã¢y cho cÃ¡c thiáº¿t bá»‹ IoT Ä‘Ã³ chÃ­nh lÃ  Bluetooth cá»¥ thá»ƒ lÃ  BLE MESH. NhÆ°ng trÆ°á»›c tiÃªn....

## Váº­y Bluetooth lÃ  gÃ¬?

- Cháº¯c háº³n ai cÅ©ng biáº¿t tá»›i sá»± hiá»‡n diá»‡n cá»§a Bluetooth xung quanh chÃºng ta, Ä‘áº·c biá»‡t trÃªn cÃ¡c thiáº¿t bá»‹ di Ä‘á»™ng. NÃ³ lÃ  má»™t chuáº©n cÃ´ng nghá»‡ truyá»n thÃ´ng khÃ´ng dÃ¢y táº§m gáº§n giá»¯a cÃ¡c thiáº¿t bá»‹ Ä‘iá»‡n tá»­. CÃ´ng nghá»‡ nÃ y há»— trá»£ viá»‡c truyá»n dá»¯ liá»‡u qua cÃ¡c khoáº£ng cÃ¡ch ngáº¯n giá»¯a cÃ¡c thiáº¿t bá»‹ di Ä‘á»™ng vÃ  cá»‘ Ä‘á»‹nh, táº¡o nÃªn cÃ¡c máº¡ng cÃ¡ nhÃ¢n khÃ´ng dÃ¢y. Bluetooth cÃ³ thá»ƒ Ä‘áº¡t Ä‘Æ°á»£c tá»‘c Ä‘á»™ truyá»n dá»¯ liá»‡u 1Mb/s.

- Theo Bluetooth SIG(Bluetooth Special Interest Group), hiá»‡n cÃ³ hÆ¡n 90% Ä‘iá»‡n thoáº¡i smartphone cÃ³ tÃ­nh nÄƒng Bluetooth, bao gá»“m cÃ¡c há»‡ Ä‘iá»u hÃ nh IOS, Android vÃ  Windows. ThÃªm ná»¯a cÃ¡c thiáº¿t bá»‹ khÃ´ng dÃ¢y Ä‘áº·c biá»‡t lÃ  tai nghe Ä‘á»u sá»­ dá»¥ng Bluetooth Ä‘á»ƒ truyá»n táº£i dá»¯ liá»‡u.
## BLE (Bluetooth low energy) - cÅ©ng lÃ  Bluetooth nhÆ°ng mÃ  nÃ³ láº¡ láº¯m
- NgÃ y 30/6/2010 Bluetooth 4.0 ra Ä‘á»i cho phÃ©p truyá»n táº£i dá»¯ liá»‡u tá»‘c Ä‘á»™ cao nhá» vÃ o Bluetooth High Speed vÃ  tiÃªu tá»‘n nÄƒng lÆ°á»£ng Ã­t hÆ¡n nhá» Bluetooth Low Energy - BLE.
- Tá»« cÃ¡i tÃªn BLE cÅ©ng Ä‘Ã£ cho biáº¿t báº£n thÃ¢n nÃ³ lÃ  gÃ¬. NÃ³ lÃ  má»™t cÃ´ng nghá»‡ máº¡ng khÃ´ng dÃ¢y tiÃªu thá»¥ ráº¥t Ã­t nÄƒng lÆ°á»£ng dÃ¹ng Ä‘á»ƒ káº¿t ná»‘i cÃ¡c thiáº¿t bá»‹ vá»›i nhau. Ban Ä‘áº§u cÃ´ng nghá»‡ nÃ y Ä‘Æ°á»£c phÃ¡t minh bá»ŸiÂ [Nokia](https://vi.wikipedia.org/wiki/Nokia) vÃ o nÄƒm 2006 vá»›i tÃªn gá»i Wibree, trÆ°á»›c khi Ä‘Æ°á»£cÂ **[Bluetooth Special Interest Group**Â (*Bluetooth SIG*)](http://en.wikipedia.org/wiki/Bluetooth_Special_Interest_Group) tÃ­ch há»£p vÃ o Bluetooth 4.0 nhÆ° mÃ¬nh Ä‘Ã£ nÃ³i á»Ÿ trÃªn. Má»¥c tiÃªu chÃ­nh cá»§a viá»‡c tÃ­ch há»£p lÃ Â **tá»‘i Æ°u hÃ³a má»©c nÄƒng lÆ°á»£ng tiÃªu thá»¥**.
- BLE khÃ´ng Ä‘Æ°á»£c xem lÃ  báº£n nÃ¢ng cáº¥p cá»§a Bluetooth thÃ´ng thÆ°á»ng, nÃ³ lÃ  má»™t cÃ´ng nghá»‡ má»›i táº­p trung vÃ oÂ IoT - nhá»¯ng thiáº¿t bá»‹ cÃ³ Ã­t dá»¯ liá»‡u Ä‘Æ°á»£c truyá»n Ä‘i á»Ÿ tá»‘c Ä‘á»™ tháº¥p.
- Khi quÃ©t, cÃ¡c thiáº¿t bá»‹ BLE Ä‘Æ°á»£c phÃ¡t hiá»‡n thÃ´ng qua má»™t quy trÃ¬nh dá»±a trÃªn viá»‡c phÃ¡t Ä‘i cÃ¡c gÃ³i quáº£ng cÃ¡o (Advertising packets). Äiá»u nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n báº±ng cÃ¡ch gá»­i má»™t gÃ³i tin trÃªn Ã­t nháº¥t má»™t trong 3 channel riÃªng biá»‡t vÃ  láº·p Ä‘i láº·p láº¡i trong má»™t khoáº£ng thá»i gian vá»›i Ä‘á»™ trá»… ngáº«u nhiÃªn lÃªn tá»›i 10ms (10 mili giÃ¢y).
## BLE vÃ  Bluetooth Classic
 Vá» cÆ¡ báº£n chÃºng cÃ³ sá»± khÃ¡c nhau mÃ  mÃ¬nh Ä‘á» cáº­p á»Ÿ dÆ°á»›i Ä‘Ã¢y
| | Classic | BLE|
|---|---| ---|
|Táº§n sá»‘ vÃ´ tuyáº¿n| 2.4GHz (2.400â€“2.4835 GHz) | 2.4GHz (2.400â€“2.4835 GHz)|
| Channels | 79 1-MHz | 40 2-MHz|
| Khoáº£ng cÃ¡ch (lÃ½ thuyáº¿t) |  Up to 100m | <100m |
| Tá»‘c Ä‘á»™ | 1-3Mbps | 1Mbps |
| Báº£o máº­t | 64-bit, 128-bit | 128-bit AES |
|Má»©c tiÃªu thá»¥ nÄƒng lÆ°á»£ng| Tháº¥p (1W lÃ m tham chiáº¿u) | Cá»±c ká»³ tháº¥p (0.01â€“0.50 W)|


## BLE Stack

MÃ¬nh sáº½ mÃ´ táº£ Stack cá»§a BLE thÃ´ng qua hÃ¬nh bÃªn dÆ°á»›i (Chá»¯ mÃ¬nh hÆ¡i xáº¥u nÃªn cÃ¡c bÃ¡c thÃ´ng cáº£m ğŸ¥²)

![Ble Stack](../Bluetooth/img/ble_stack.png)

- **Application Layer**: Lá»›p á»©ng dá»¥ng - lÃ  lá»›p tÆ°á»ng tÃ¡c trá»±c tiáº¿p vá»›i ngÆ°á»i dÃ¹ng. Chá»©a giao diá»‡n, logic vÃ  kiáº¿n trÃºc á»©ng dá»¥ng chung.
- **Host Layer**: LÃ  lá»›p theo sau Application gá»“m nhiá»u cáº¥u trÃºc khÃ¡c nhau.
    - **Generic Access Profile (GAP)**: Pháº§n nÃ y mÃ´ táº£ cÃ¡ch cÃ¡c thiáº¿t bá»‹ BLE giao tiáº¿p vá»›i nhau. CÃ³ thá»ƒ hiá»ƒu nÃ³ nhÆ° má»™t bá»™ pháº­n chá»‹u trÃ¡ch nhiá»‡m
    cÃ¡ch cÃ¡c thiáº¿t bá»‹ phÃ¡t hiá»‡n ra nhau Ä‘á»ƒ giao tiáº¿p.
    - **Generic Attribute Profile (GATT)** Pháº§n nÃ y gáº§n giá»‘ng vá»›i GAP, mÃ´ táº£ cÃ¡ch cÃ¡c thuá»™c tÃ­nh Ä‘Æ°á»£c Ä‘á»‹nh dáº¡ng, Ä‘Ã³ng gÃ³i vÃ  chuyá»ƒn giao tá»›i thiáº¿t bá»‹ Ä‘Æ°á»£c káº¿t ná»‘i. ÄÆ°á»£c Application sá»­ dá»¥ng cho hoáº¡t Ä‘á»™ng trao Ä‘á»•i thÃ´ng tin theo dáº¡ng Client - Server. (Pháº§n nÃ y mÃ¬nh sáº½ dÃ nh riÃªng Ä‘á»ƒ chi tiáº¿t hÆ¡n trong bÃ i viáº¿t tiáº¿p theo)
    - **Attribute Protocal (ATT)**: ÄÃ¢y lÃ  nÆ¡i cáº¥u hÃ¬nh cÃ¡c quy táº¯c vá» cÃ¡ch GATT hoáº¡t Ä‘á»™ng, quy Ä‘á»‹nh thiáº¿t bá»‹ Ä‘ang lÃ  Client hay Server. Server chá»©a dá»¯ liá»‡u tá»• chá»©c thÃ nh cÃ¡c attribute. Má»—i attribute láº¡i bao gá»“m 16-bit handler, má»™t UUID Ä‘á»‹nh danh, má»™t giÃ¡ trá»‹(value) vÃ  táº­p cÃ¡c permission.
    - **Security Manager Protocol (SMP)** ThÃ nh pháº§n nÃ y giÃºp Ä‘áº£m báº£o sá»± báº£o máº­t giá»¯a hai hay nhiá»u thiáº¿t bá»‹. 
    - **Logical Link Control and Adaption Protocol (L2CAP)** CÃ¡c gÃ³i tin thÃ´ng qua thÃ nh pháº§n nÃ y sáº½ Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i thÃ nh cÃ¡c gÃ³i BLE tiÃªu chuáº©n báº±ng cÃ¡ch chuyá»ƒn Ä‘á»•i cÃ¡c giao thá»©c. Äá»“ng thá»i Ä‘á»‘i vá»›i nhá»¯ng gÃ³i tin lá»›n nÃ³ sáº½ tÃ¡ch nhá» hoáº·c káº¿t há»£p Ä‘á»ƒ tÃ¡i táº¡o gÃ³i tin.
-**Host Controller Interface (HCI)**: Lá»›p trung gian chá»‹u trÃ¡ch nhiá»‡m váº­n chuyá»ƒn cÃ¡c lá»‡nh, sá»± kiá»‡n giá»¯a host vÃ  controller. Lá»›p nÃ y Ä‘Æ°Æ¡c triá»ƒn khai thÃ´ng qua má»™t sá»‘ giao thá»©c nhÆ° SPI hoáº·c UART. 
- **Controller Layer** Táº§ng Ä‘iá»u khiá»ƒn - lÃ  bá»™ pháº§n pháº§n cá»©ng cá»§a kiáº¿n trÃºc BLE Ä‘áº£m báº£o thá»±c hiá»ƒn cÃ¡c chá»©c nÄƒng Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh nhÆ° quÃ©t(scan), quáº£ng bÃ¡(adverises), giao tiáº¿p giá»¯a cÃ¡c thiáº¿t bá»‹. 



## Káº¿t
- MÃ¬nh biáº¿t Ä‘á»‘ng chá»¯ trÃªn cÃ³ váº» hÆ¡i tá»Ÿm nhÆ°ng mÃ  mÃ¬nh Ä‘ang cá»‘ gáº¯ng tÃ¬m cÃ¡ch Ä‘á»ƒ nÃ³ trá»Ÿ nÃªn dá»… hiá»ƒu hÆ¡n ná»¯a cho Ä‘Ãºng vá»›i tÃªn gá»i ```IoT for baby```, bá»Ÿi Ä‘áº¿n mÃ¬nh cÅ©ng tháº¥y Ä‘á»‘ng chá»¯ nÃ y Ä‘Ã¡ng sá»£ mÃ  ğŸŒšğŸŒšğŸŒš.
- Náº¿u cÃ¡c báº¡n tháº¥y nhá»¯ng bÃ i viáº¿t cá»§a mÃ¬nh cÃ³ Ã­ch hÃ£y á»§ng há»™ mÃ¬nh báº±ng báº¥t cá»© cÃ¡ch nÃ o cÃ³ thá»ƒ dÃ¹ chá»‰ lÃ  má»™t star cho [Prolearners Project](https://github.com/doctor-blue/prolearners-site) cÅ©ng Ä‘á»§ Ä‘á»ƒ mÃ¬nh tháº¥y vui cáº£ ngÃ y rá»“i!

    ```See u next time! Peace!!!```